<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>IMDB Project</title>
    <script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
</head>

<body>
    <h1>Homepage</h1>
    {% if curuser %}
        <h2> {{curuser}} has logged in </h2>
    {% endif %}

    <form action='/reg/{{curuser}}' method="POST">
        {% csrf_token %}
        <button>Profile</button>
    </form>

    <h2>Search bar</h2>
    <form action="/search/searchpage" method="POST" class="ajax_form">
        {% csrf_token %}
        <input type="search" name="search" id="ajax_search">
        <select name="search_option" id="searchselect">
          <option value="multi">All</option>
          <option value="movie">Movies</option>
          <option value="person">People</option>
          <option value="keyword">Keywords</option>
        </select>
        <input type="submit" value="search">
    </form>
    <div id = 'searches'>
     
    </div>

    <!-- <form action='/search' method="POST">
        {% csrf_token %}
        <input type="text" name="search" id="search" value="movies">
        <input type="submit" value="Search">
    </form> -->
    
    <form action='/watchlist' method="POST">
        {% csrf_token %}
        <button>Watchlist</button>
    </form>

    <form action='/{{reg}}' method="POST">
        {% csrf_token %}
        <button>{{label}}</button>
    </form>





    <hr>

    <!-- API Entries --> 
    <h2>Sample API Entries</h2>
    <table>
        <tr>
            <th>Image</th>
            <th>Title</th>
            <th>Release Date</th>
            <th>Options</th>
        </tr>
        {% for task in user.assigned.all %}
        <tr>
            <td>{{task.task_name}}</td>
            <td>{{task.task_time}}</td>
            <td>{{task.task_date}}</td>
            <td>{{task.task_status}}</td>
            <td>
                <a href="/belt/{{task.id}}/edit">Edit</a>
                <a href="/belt/{{task.id}}/delete">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    {% for user in users %}
    <div class=userbox>
        User:
        <a href="/user/{{user.id}}">{{user.first_name}} {{user.last_name}}</a>
        <br> {{user.email}}
        <br> {{user.created_at}}
        <br>
        <a href="/user/{{user.id}}">Profile</a>
        <a href="/user/{{user.id}}/edit">Edit</a>
        <a href="/user/{{user.id}}/delete">Delete</a>
    </div>
    {% endfor %}


</body>
<script>
    
    $('.ajax_form').submit(function(e){
    //   e.preventDefault()
    })
    $('#ajax_search').keyup(function(){
      var search_option = $('#searchselect').val()
      $.ajax({
        url: '/search/'+search_option+'/', 
        method: 'post', 
        data: $(this).parent().serialize(),
        success: function(serverResponse) { 
        $('#searches').html(serverResponse)
        }
      })
    });
  </script>

</html>